/* sigmajs.org - an open-source light-weight JavaScript graph drawing library - Version: 0.1 - Author:  Alexis Jacomy - License: MIT */
var sigma={tools:{},classes:{},instances:{}};
(function(){Array.prototype.some||(Array.prototype.some=function(B,k){var g=this.length;if("function"!=typeof B)throw new TypeError;for(var a=0;a<g;a++)if(a in this&&B.call(k,this[a],a,this))return!0;return!1});Array.prototype.forEach||(Array.prototype.forEach=function(k,g){var l=this.length;if(typeof k!="function")throw new TypeError;for(var a=0;a<l;a++)a in this&&k.call(g,this[a],a,this)});Array.prototype.map||(Array.prototype.map=function(k,g){var l=this.length;if(typeof k!="function")throw new TypeError;
for(var a=Array(l),j=0;j<l;j++)j in this&&(a[j]=k.call(g,this[j],j,this));return a});Array.prototype.filter||(Array.prototype.filter=function(k,g){var l=this.length;if(typeof k!="function")throw new TypeError;for(var a=[],j=0;j<l;j++)if(j in this){var d=this[j];k.call(g,d,j,this)&&a.push(d)}return a});if(!Object.keys){var k=Object,p=Object.prototype.hasOwnProperty,g=!{toString:null}.propertyIsEnumerable("toString"),l="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),
C=l.length;k.keys=function(k){if(typeof k!=="object"&&typeof k!=="function"||k===null)throw new TypeError("Object.keys called on non-object");var s=[],t;for(t in k)p.call(k,t)&&s.push(t);if(g)for(t=0;t<C;t++)p.call(k,l[t])&&s.push(l[t]);return s}}})();sigma.classes.Cascade=function(){this.p={};this.config=function(k,p){if("string"==typeof k&&void 0==p)return this.p[k];var g="object"==typeof k&&void 0==p?k:{};"string"==typeof k&&(g[k]=p);for(var l in g)void 0!=this.p[l]&&(this.p[l]=g[l]);return this}};
sigma.classes.EventDispatcher=function(){var k={},p=this;this.one=function(g,l){if(!l||!g)return p;("string"==typeof g?g.split(" "):g).forEach(function(g){k[g]||(k[g]=[]);k[g].push({h:l,one:!0})});return p};this.bind=function(g,l){if(!l||!g)return p;("string"==typeof g?g.split(" "):g).forEach(function(g){k[g]||(k[g]=[]);k[g].push({h:l,one:!1})});return p};this.unbind=function(g,l){g||(k={});var C="string"==typeof g?g.split(" "):g;l?C.forEach(function(g){k[g]&&(k[g]=k[g].filter(function(g){return g.h!=
l}));k[g]&&0==k[g].length&&delete k[g]}):C.forEach(function(g){delete k[g]});return p};this.dispatch=function(g,l){k[g]&&(k[g].forEach(function(k){k.h({type:g,content:l,target:p})}),k[g]=k[g].filter(function(g){return!g.one}));return p}};
(function(){function k(){function a(h){return{x:h.x,y:h.y,size:h.size,degree:h.degree,inDegree:h.inDegree,outDegree:h.outDegree,displayX:h.displayX,displayY:h.displayY,displaySize:h.displaySize,label:h.label,id:h.id,color:h.color,fixed:h.fixed,active:h.active,hidden:h.hidden,forceLabel:h.forceLabel,attr:h.attr}}function j(h){return{source:h.source.id,target:h.target.id,size:h.size,type:h.type,weight:h.weight,displaySize:h.displaySize,label:h.label,hidden:h.hidden,id:h.id,attr:h.attr,color:h.color}}
function d(){c.nodes=[];c.nodesIndex={};c.edges=[];c.edgesIndex={};return c}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var c=this;this.p={minNodeSize:0,maxNodeSize:0,minEdgeSize:0,maxEdgeSize:0,scalingMode:"inside",nodesPowRatio:0.5,edgesPowRatio:0};this.borders={};d();this.addNode=function(h,a){if(c.nodesIndex[h])throw Error('Node "'+h+'" already exists.');var a=a||{},b={x:0,y:0,size:1,degree:0,inDegree:0,outDegree:0,fixed:!1,active:!1,hidden:!1,forceLabel:!1,label:h.toString(),
id:h.toString(),attr:{}},d;for(d in a)switch(d){case "id":break;case "x":case "y":case "size":b[d]=+a[d];break;case "fixed":case "active":case "hidden":case "forceLabel":b[d]=!!a[d];break;case "color":case "label":b[d]=a[d];break;default:b.attr[d]=a[d]}c.nodes.push(b);c.nodesIndex[h.toString()]=b;return c};this.addEdge=function(a,d,b,j){if(c.edgesIndex[a])throw Error('Edge "'+a+'" already exists.');if(!c.nodesIndex[d])throw Error("Edge's source \""+d+'" does not exist yet.');if(!c.nodesIndex[b])throw Error("Edge's target \""+
b+'" does not exist yet.');j=j||{};d={source:c.nodesIndex[d],target:c.nodesIndex[b],size:1,weight:1,displaySize:0.5,label:a.toString(),id:a.toString(),hidden:!1,attr:{}};d.source.degree++;d.source.outDegree++;d.target.degree++;d.target.inDegree++;for(var f in j)switch(f){case "id":case "source":case "target":break;case "hidden":d[f]=!!j[f];break;case "size":case "weight":d[f]=+j[f];break;case "color":d[f]=j[f].toString();break;case "type":d[f]=j[f].toString();break;case "label":d[f]=j[f];break;default:d.attr[f]=
j[f]}c.edges.push(d);c.edgesIndex[a.toString()]=d;return c};this.dropNode=function(a){((a instanceof Array?a:[a])||[]).forEach(function(a){if(c.nodesIndex[a]){var b=null;c.nodes.some(function(c,f){return c.id==a?(b=f,!0):!1});null!=b&&c.nodes.splice(b,1);delete c.nodesIndex[a];c.edges=c.edges.filter(function(b){return b.source.id==a?(delete c.edgesIndex[b.id],b.target.degree--,b.target.inDegree--,!1):b.target.id==a?(delete c.edgesIndex[b.id],b.source.degree--,b.source.outDegree--,!1):!0})}else sigma.log('Node "'+
a+'" does not exist.')});return c};this.dropEdge=function(a){((a instanceof Array?a:[a])||[]).forEach(function(a){if(c.edgesIndex[a]){c.edgesIndex[a].source.degree--;c.edgesIndex[a].source.outDegree--;c.edgesIndex[a].target.degree--;c.edgesIndex[a].target.inDegree--;var b=null;c.edges.some(function(c,f){return c.id==a?(b=f,!0):!1});null!=b&&c.edges.splice(b,1);delete c.edgesIndex[a]}else sigma.log('Edge "'+a+'" does not exist.')});return c};this.iterEdges=function(a,d){var b=d?d.map(function(a){return c.edgesIndex[a]}):
c.edges,g=b.map(j);g.forEach(a);b.forEach(function(a,b){var h=g[b],d;for(d in h)switch(d){case "id":case "displaySize":break;case "weight":case "size":a[d]=+h[d];break;case "source":case "target":a[d]=c.nodesIndex[d]||a[d];break;case "hidden":a[d]=!!h[d];break;case "color":case "label":case "type":a[d]=(h[d]||"").toString();break;default:a.attr[d]=h[d]}});return c};this.iterNodes=function(h,d){var b=d?d.map(function(a){return c.nodesIndex[a]}):c.nodes,j=b.map(a);j.forEach(h);b.forEach(function(a,
b){var c=j[b],h;for(h in c)switch(h){case "id":case "attr":case "degree":case "inDegree":case "outDegree":case "displayX":case "displayY":case "displaySize":break;case "x":case "y":case "size":a[h]=+c[h];break;case "fixed":case "active":case "hidden":case "forceLabel":a[h]=!!c[h];break;case "color":case "label":a[h]=(c[h]||"").toString();break;default:a.attr[h]=c[h]}});return c};this.getEdges=function(a){var d=((a instanceof Array?a:[a])||[]).map(function(a){return j(c.edgesIndex[a])});return a instanceof
Array?d:d[0]};this.getNodes=function(h){var d=((h instanceof Array?h:[h])||[]).map(function(b){return a(c.nodesIndex[b])});return h instanceof Array?d:d[0]};this.empty=d;this.rescale=function(a,d,b,j){var f=0,i=0;b&&c.nodes.forEach(function(a){i=Math.max(a.size,i)});j&&c.edges.forEach(function(a){f=Math.max(a.size,f)});var i=i||1,f=f||1,g,k,q,n;b&&c.nodes.forEach(function(a){k=Math.max(a.x,k||a.x);g=Math.min(a.x,g||a.x);n=Math.max(a.y,n||a.y);q=Math.min(a.y,q||a.y)});var r="outside"==c.p.scalingMode?
Math.max(a/Math.max(k-g,1),d/Math.max(n-q,1)):Math.min(a/Math.max(k-g,1),d/Math.max(n-q,1)),l=(c.p.maxNodeSize||i)/r;k+=l;g-=l;n+=l;q-=l;var r="outside"==c.p.scalingMode?Math.max(a/Math.max(k-g,1),d/Math.max(n-q,1)):Math.min(a/Math.max(k-g,1),d/Math.max(n-q,1)),u,v;!c.p.maxNodeSize&&!c.p.minNodeSize?(u=1,v=0):c.p.maxNodeSize==c.p.minNodeSize?(u=0,v=c.p.maxNodeSize):(u=(c.p.maxNodeSize-c.p.minNodeSize)/i,v=c.p.minNodeSize);var w,x;!c.p.maxEdgeSize&&!c.p.minEdgeSize?(w=1,x=0):(w=c.p.maxEdgeSize==c.p.minEdgeSize?
0:(c.p.maxEdgeSize-c.p.minEdgeSize)/f,x=c.p.minEdgeSize);b&&c.nodes.forEach(function(b){b.displaySize=b.size*u+v;if(!b.fixed){b.displayX=(b.x-(k+g)/2)*r+a/2;b.displayY=(b.y-(n+q)/2)*r+d/2}});j&&c.edges.forEach(function(a){a.displaySize=a.size*w+x});return c};this.translate=function(a,d,b,j,f){var i=Math.pow(b,c.p.nodesPowRatio);j&&c.nodes.forEach(function(c){c.fixed||(c.displayX=c.displayX*b+a,c.displayY=c.displayY*b+d);c.displaySize*=i});i=Math.pow(b,c.p.edgesPowRatio);f&&c.edges.forEach(function(a){a.displaySize*=
i});return c};this.setBorders=function(){c.borders={};c.nodes.forEach(function(a){c.borders.minX=Math.min(void 0==c.borders.minX?a.displayX-a.displaySize:c.borders.minX,a.displayX-a.displaySize);c.borders.maxX=Math.max(void 0==c.borders.maxX?a.displayX+a.displaySize:c.borders.maxX,a.displayX+a.displaySize);c.borders.minY=Math.min(void 0==c.borders.minY?a.displayY-a.displaySize:c.borders.minY,a.displayY-a.displaySize);c.borders.maxY=Math.max(void 0==c.borders.maxY?a.displayY-a.displaySize:c.borders.maxY,
a.displayY-a.displaySize)})};this.checkHover=function(a,d){var b,j,f,i=[],g=[];c.nodes.forEach(function(c){if(c.hidden)c.hover=!1;else{b=Math.abs(c.displayX-a);j=Math.abs(c.displayY-d);f=c.displaySize;var q=c.hover,n=b<f&&j<f&&Math.sqrt(b*b+j*j)<f;q&&!n?(c.hover=!1,g.push(c.id)):n&&!q&&(c.hover=!0,i.push(c.id))}});i.length&&c.dispatch("overnodes",i);g.length&&c.dispatch("outnodes",g);return c};this.checkClick=function(a,d){var b,j,f,i=[];c.nodes.forEach(function(c){if(!c.hidden&&(b=Math.abs(c.displayX-
a),j=Math.abs(c.displayY-d),f=c.displaySize,b<f&&j<f&&Math.sqrt(b*b+j*j)<f))return i.push(c.id),!1});i.length&&c.dispatch("click",i);return c}}function p(a,j){function d(){var a;a="<p>GLOBAL :</p>";for(var d in c.p.globalProbes)a+="<p>"+d+" : "+c.p.globalProbes[d]()+"</p>";a+="<br><p>LOCAL :</p>";for(d in c.p.localProbes)a+="<p>"+d+" : "+c.p.localProbes[d]()+"</p>";c.p.dom.innerHTML=a;return c}sigma.classes.Cascade.call(this);var c=this;this.instance=a;this.monitoring=!1;this.p={fps:40,dom:j,globalProbes:{"Time (ms)":sigma.chronos.getExecutionTime,
Queue:sigma.chronos.getQueuedTasksCount,Tasks:sigma.chronos.getTasksCount,FPS:sigma.chronos.getFPS},localProbes:{"Nodes count":function(){return c.instance.graph.nodes.length},"Edges count":function(){return c.instance.graph.edges.length}}};this.activate=function(){c.monitoring||(c.monitoring=window.setInterval(d,1E3/c.p.fps));return c};this.desactivate=function(){c.monitoring&&(window.clearInterval(c.monitoring),c.monitoring=null,c.p.dom.innerHTML="");return c}}function g(a){function j(a){f.mouseX=
void 0!=a.offsetX&&a.offsetX||void 0!=a.layerX&&a.layerX||void 0!=a.clientX&&a.clientX;f.mouseY=void 0!=a.offsetY&&a.offsetY||void 0!=a.layerY&&a.layerY||void 0!=a.clientY&&a.clientY;if(f.isMouseDown){var b=f.mouseX-i+z,c=f.mouseY-l+q;if(b!=f.stageX||c!=f.stageY)v=u,x=w,u=b,w=c,f.stageX=b,f.stageY=c,f.dispatch("drag")}f.isMove=!0;f.dispatch("move");a.preventDefault?a.preventDefault():a.returnValue=!1}function d(a){f.p.mouseEnabled&&f.isMouseDown&&(f.isMouseDown=!1,f.dispatch("mouseup"),(z!=f.stageX||
q!=f.stageY)&&b(f.stageX+f.p.inertia*(f.stageX-v),f.stageY+f.p.inertia*(f.stageY-x)),a.preventDefault?a.preventDefault():a.returnValue=!1)}function c(a){f.p.mouseEnabled&&(f.isMouseDown=!0,f.isMove=!1,f.dispatch("mousedown"),z=f.stageX,q=f.stageY,i=f.mouseX,l=f.mouseY,v=u=f.stageX,x=w=f.stageY,f.dispatch("startdrag"),a.preventDefault?a.preventDefault():a.returnValue=!1)}function h(){f.isMove||f.dispatch("click")}function g(a){if(f.p.mouseEnabled){var c=f.ratio*(0<(void 0!=a.wheelDelta&&a.wheelDelta||
void 0!=a.detail&&-a.detail)?f.p.zoomMultiply:1/f.p.zoomMultiply),c=Math.min(Math.max(c,f.p.minRatio),f.p.maxRatio);b(f.mouseX,f.mouseY,c);f.dispatch("mousewheel",c);f.p.blockScroll&&(a.preventDefault?a.preventDefault():a.returnValue=!1)}}function b(a,b,c){if(!f.isMouseDown&&(window.clearInterval(f.interpolationID),o=void 0!=c,z=f.stageX,r=a,q=f.stageY,A=b,n=c||f.ratio,n=Math.min(Math.max(n,f.p.minRatio),f.p.maxRatio),m=f.p.directZooming?1-(o?f.p.zoomDelta:f.p.dragDelta):0,f.ratio!=n||f.stageX!=r||
f.stageY!=A))k(),f.interpolationID=window.setInterval(k,50),f.dispatch("startinterpolate")}function k(){m+=o?f.p.zoomDelta:f.p.dragDelta;m=Math.min(m,1);var a=sigma.easing.quadratic.easeout(m),c=f.ratio;f.ratio=c*(1-a)+n*a;o?(f.stageX=r+(f.stageX-r)*f.ratio/c,f.stageY=A+(f.stageY-A)*f.ratio/c):(f.stageX=z*(1-a)+r*a,f.stageY=q*(1-a)+A*a);f.dispatch("interpolate");1<=m&&(window.clearInterval(f.interpolationID),a=f.ratio,o?(f.ratio=n,f.stageX=r+(f.stageX-r)*f.ratio/a,f.stageY=A+(f.stageY-A)*f.ratio/
a):(f.stageX=r,f.stageY=A),f.dispatch("stopinterpolate"))}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var f=this;this.p={minRatio:1,maxRatio:32,marginRatio:1,zoomDelta:0.1,dragDelta:0.3,zoomMultiply:2,directZooming:!1,blockScroll:!0,inertia:1.1,mouseEnabled:!0};var i=0,l=0,z=0,q=0,n=1,r=0,A=0,u=0,v=0,w=0,x=0,m=0,o=!1;this.stageY=this.stageX=0;this.ratio=1;this.mouseY=this.mouseX=0;this.isMove=this.isMouseDown=!1;document.addEventListener?(a.addEventListener("DOMMouseScroll",
g,!0),a.addEventListener("mousewheel",g,!0),a.addEventListener("mousemove",j,!0),a.addEventListener("mousedown",c,!0),a.addEventListener("click",h,!0),document.addEventListener("mouseup",d,!0)):(a.attachEvent("onmousewheel",g),a.attachEvent("onmousemove",j),a.attachEvent("onmousedown",c),a.attachEvent("onclick",h),document.attachEvent("onmouseup",d));this.checkBorders=function(){return f};this.interpolate=b}function l(a,j,d,c,h,g,b){function k(a){var b=c,d="fixed"==i.p.labelSize?i.p.defaultLabelSize:
i.p.labelSizeRatio*a.displaySize;b.font=(i.p.hoverFontStyle||i.p.fontStyle||"")+" "+d+"px "+(i.p.hoverFont||i.p.font||"");b.fillStyle="node"==i.p.labelHoverBGColor?a.color||i.p.defaultNodeColor:i.p.defaultHoverLabelBGColor;b.beginPath();i.p.labelHoverShadow&&(b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=4,b.shadowColor=i.p.labelHoverShadowColor);sigma.tools.drawRoundRect(b,Math.round(a.displayX-d/2-2),Math.round(a.displayY-d/2-2),Math.round(b.measureText(a.label).width+1.5*a.displaySize+d/2+4),
Math.round(d+4),Math.round(d/2+2),"left");b.closePath();b.fill();b.shadowOffsetX=0;b.shadowOffsetY=0;b.shadowBlur=0;b.beginPath();b.fillStyle="node"==i.p.nodeBorderColor?a.color||i.p.defaultNodeColor:i.p.defaultNodeBorderColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize+i.p.borderSize,0,2*Math.PI,!0);b.closePath();b.fill();b.beginPath();b.fillStyle="node"==i.p.nodeHoverColor?a.color||i.p.defaultNodeColor:i.p.defaultNodeHoverColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),
a.displaySize,0,2*Math.PI,!0);b.closePath();b.fill();b.fillStyle="node"==i.p.labelHoverColor?a.color||i.p.defaultNodeColor:i.p.defaultLabelHoverColor;b.fillText(a.label,Math.round(a.displayX+1.5*a.displaySize),Math.round(a.displayY+d/2-3));return i}function f(a){if(isNaN(a.x)||isNaN(a.y))throw Error("A node's coordinate is not a number (id: "+a.id+")");return!a.hidden&&a.displayX+a.displaySize>-l/3&&a.displayX-a.displaySize<4*l/3&&a.displayY+a.displaySize>-z/3&&a.displayY-a.displaySize<4*z/3}sigma.classes.Cascade.call(this);
var i=this;this.p={labelColor:"default",defaultLabelColor:"#000",labelHoverBGColor:"default",defaultHoverLabelBGColor:"#fff",labelHoverShadow:!0,labelHoverShadowColor:"#000",labelHoverColor:"default",defaultLabelHoverColor:"#000",labelActiveBGColor:"default",defaultActiveLabelBGColor:"#fff",labelActiveShadow:!0,labelActiveShadowColor:"#000",labelActiveColor:"default",defaultLabelActiveColor:"#000",labelSize:"fixed",defaultLabelSize:12,labelSizeRatio:2,labelThreshold:6,font:"Arial",hoverFont:"",activeFont:"",
fontStyle:"",hoverFontStyle:"",activeFontStyle:"",edgeColor:"source",defaultEdgeColor:"#aaa",defaultEdgeType:"line",defaultNodeColor:"#aaa",nodeHoverColor:"node",defaultNodeHoverColor:"#fff",nodeActiveColor:"node",defaultNodeActiveColor:"#fff",borderSize:0,nodeBorderColor:"node",defaultNodeBorderColor:"#fff",edgesSpeed:200,nodesSpeed:200,labelsSpeed:200};var l=g,z=b;this.currentLabelIndex=this.currentNodeIndex=this.currentEdgeIndex=0;this.task_drawLabel=function(){for(var a=h.nodes.length,b=0;b++<
i.p.labelsSpeed&&i.currentLabelIndex<a;)if(i.isOnScreen(h.nodes[i.currentLabelIndex])){var c=h.nodes[i.currentLabelIndex++],f=d;if(c.displaySize>=i.p.labelThreshold||c.forceLabel){var j="fixed"==i.p.labelSize?i.p.defaultLabelSize:i.p.labelSizeRatio*c.displaySize;f.font=i.p.fontStyle+j+"px "+i.p.font;f.fillStyle="node"==i.p.labelColor?c.color||i.p.defaultNodeColor:i.p.defaultLabelColor;f.fillText(c.label,Math.round(c.displayX+1.5*c.displaySize),Math.round(c.displayY+j/2-3))}}else i.currentLabelIndex++;
return i.currentLabelIndex<a};this.task_drawEdge=function(){for(var a=h.edges.length,b,c,d=0;d++<i.p.edgesSpeed&&i.currentEdgeIndex<a;)if(e=h.edges[i.currentEdgeIndex],b=e.source,c=e.target,e.hidden||b.hidden||c.hidden||!i.isOnScreen(b)&&!i.isOnScreen(c))i.currentEdgeIndex++;else{b=h.edges[i.currentEdgeIndex++];c=b.source.displayX;var f=b.source.displayY,g=b.target.displayX,k=b.target.displayY,l=b.color;if(!l)switch(i.p.edgeColor){case "source":l=b.source.color||i.p.defaultNodeColor;break;case "target":l=
b.target.color||i.p.defaultNodeColor;break;default:l=i.p.defaultEdgeColor}var m=j;switch(b.type||i.p.defaultEdgeType){case "curve":m.strokeStyle=l;m.lineWidth=b.displaySize/3;m.beginPath();m.moveTo(c,f);m.quadraticCurveTo((c+g)/2+(k-f)/4,(f+k)/2+(c-g)/4,g,k);m.stroke();break;default:m.strokeStyle=l,m.lineWidth=b.displaySize/3,m.beginPath(),m.moveTo(c,f),m.lineTo(g,k),m.stroke()}}return i.currentEdgeIndex<a};this.task_drawNode=function(){for(var b=h.nodes.length,c=0;c++<i.p.nodesSpeed&&i.currentNodeIndex<
b;)if(i.isOnScreen(h.nodes[i.currentNodeIndex])){var d=h.nodes[i.currentNodeIndex++],f=Math.round(10*d.displaySize)/10,j=a;j.fillStyle=d.color;j.beginPath();j.arc(d.displayX,d.displayY,f,0,2*Math.PI,!0);j.closePath();j.fill();d.hover&&k(d)}else i.currentNodeIndex++;return i.currentNodeIndex<b};this.drawActiveNode=function(a){var b=c;if(!f(a))return i;var d="fixed"==i.p.labelSize?i.p.defaultLabelSize:i.p.labelSizeRatio*a.displaySize;b.font=(i.p.activeFontStyle||i.p.fontStyle||"")+" "+d+"px "+(i.p.activeFont||
i.p.font||"");b.fillStyle="node"==i.p.labelHoverBGColor?a.color||i.p.defaultNodeColor:i.p.defaultActiveLabelBGColor;b.beginPath();i.p.labelActiveShadow&&(b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=4,b.shadowColor=i.p.labelActiveShadowColor);sigma.tools.drawRoundRect(b,Math.round(a.displayX-d/2-2),Math.round(a.displayY-d/2-2),Math.round(b.measureText(a.label).width+1.5*a.displaySize+d/2+4),Math.round(d+4),Math.round(d/2+2),"left");b.closePath();b.fill();b.shadowOffsetX=0;b.shadowOffsetY=0;b.shadowBlur=
0;b.beginPath();b.fillStyle="node"==i.p.nodeBorderColor?a.color||i.p.defaultNodeColor:i.p.defaultNodeBorderColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize+i.p.borderSize,0,2*Math.PI,!0);b.closePath();b.fill();b.beginPath();b.fillStyle="node"==i.p.nodeActiveColor?a.color||i.p.defaultNodeColor:i.p.defaultNodeActiveColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize,0,2*Math.PI,!0);b.closePath();b.fill();b.fillStyle="node"==i.p.labelActiveColor?a.color||i.p.defaultNodeColor:
i.p.defaultLabelActiveColor;b.fillText(a.label,Math.round(a.displayX+1.5*a.displaySize),Math.round(a.displayY+d/2-3));return i};this.drawHoverNode=k;this.isOnScreen=f;this.resize=function(a,b){l=a;z=b;return i}}function C(a,j){function d(){sigma.chronos.removeTask("node_"+b.id,2).removeTask("edge_"+b.id,2).removeTask("label_"+b.id,2).stopTasks();return b}function c(a,c){b.domElements[a]=document.createElement(c);b.domElements[a].style.position="absolute";b.domElements[a].setAttribute("id","sigma_"+
a+"_"+b.id);b.domElements[a].setAttribute("class","sigma_"+a+"_"+c);b.domElements[a].setAttribute("width",b.width+"px");b.domElements[a].setAttribute("height",b.height+"px");b.domRoot.appendChild(b.domElements[a]);return b}function h(){b.p.drawHoverNodes&&(b.graph.checkHover(b.mousecaptor.mouseX,b.mousecaptor.mouseY),b.graph.nodes.forEach(function(a){a.hover&&!a.active&&b.plotter.drawHoverNode(a)}));return b}function D(){b.p.drawActiveNodes&&b.graph.nodes.forEach(function(a){a.active&&b.plotter.drawActiveNode(a)});
return b}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var b=this;this.id=j.toString();this.p={auto:!0,drawNodes:2,drawEdges:1,drawLabels:2,lastNodes:2,lastEdges:0,lastLabels:2,drawHoverNodes:!0,drawActiveNodes:!0};this.domRoot=a;this.width=this.domRoot.offsetWidth;this.height=this.domRoot.offsetHeight;this.graph=new k;this.domElements={};c("edges","canvas");c("nodes","canvas");c("labels","canvas");c("hover","canvas");c("monitor","div");c("mouse","canvas");this.plotter=
new l(this.domElements.nodes.getContext("2d"),this.domElements.edges.getContext("2d"),this.domElements.labels.getContext("2d"),this.domElements.hover.getContext("2d"),this.graph,this.width,this.height);this.monitor=new p(this,this.domElements.monitor);this.mousecaptor=new g(this.domElements.mouse,this.id);this.mousecaptor.bind("drag interpolate",function(){b.draw(b.p.auto?2:b.p.drawNodes,b.p.auto?0:b.p.drawEdges,b.p.auto?2:b.p.drawLabels,!0)}).bind("stopdrag stopinterpolate",function(){b.draw(b.p.auto?
2:b.p.drawNodes,b.p.auto?1:b.p.drawEdges,b.p.auto?2:b.p.drawLabels,!0)}).bind("mousedown mouseup",function(a){var c=b.graph.nodes.filter(function(a){return!!a.hover}).map(function(a){return a.id});b.dispatch("mousedown"==a.type?"downgraph":"upgraph");c.length&&b.dispatch("mousedown"==a.type?"downnodes":"upnodes",c)}).bind("move",function(){b.domElements.hover.getContext("2d").clearRect(0,0,b.domElements.hover.width,b.domElements.hover.height);h();D()}).bind("click",function(){b.graph.checkClick(b.mousecaptor.mouseX,
b.mousecaptor.mouseY)});sigma.chronos.bind("startgenerators",function(){sigma.chronos.getGeneratorsIDs().some(function(a){return!!a.match(RegExp("_ext_"+b.id+"$",""))})&&b.draw(b.p.auto?2:b.p.drawNodes,b.p.auto?0:b.p.drawEdges,b.p.auto?2:b.p.drawLabels)}).bind("stopgenerators",function(){b.draw()});for(var E=0;E<t.plugins.length;E++)t.plugins[E](this);this.draw=function(a,c,h,j){if(j&&sigma.chronos.getGeneratorsIDs().some(function(a){return!!a.match(RegExp("_ext_"+b.id+"$",""))}))return b;a=void 0==
a?b.p.drawNodes:a;c=void 0==c?b.p.drawEdges:c;h=void 0==h?b.p.drawLabels:h;j={nodes:a,edges:c,labels:h};b.p.lastNodes=a;b.p.lastEdges=c;b.p.lastLabels=h;d();b.graph.rescale(b.width,b.height,0<a,0<c).setBorders();b.mousecaptor.checkBorders(b.graph.borders,b.width,b.height);b.graph.translate(b.mousecaptor.stageX,b.mousecaptor.stageY,b.mousecaptor.ratio,0<a,0<c);b.dispatch("graphscaled");for(var g in b.domElements)"canvas"==b.domElements[g].nodeName.toLowerCase()&&(void 0==j[g]||0<=j[g])&&b.domElements[g].getContext("2d").clearRect(0,
0,b.domElements[g].width,b.domElements[g].height);b.plotter.currentEdgeIndex=0;b.plotter.currentNodeIndex=0;b.plotter.currentLabelIndex=0;g=null;j=!1;if(a)if(1<a)for(;b.plotter.task_drawNode(););else sigma.chronos.addTask(b.plotter.task_drawNode,"node_"+b.id,!1),j=!0,g="node_"+b.id;if(h)if(1<h)for(;b.plotter.task_drawLabel(););else g?sigma.chronos.queueTask(b.plotter.task_drawLabel,"label_"+b.id,g):sigma.chronos.addTask(b.plotter.task_drawLabel,"label_"+b.id,!1),j=!0,g="label_"+b.id;if(c)if(1<c)for(;b.plotter.task_drawEdge(););
else g?sigma.chronos.queueTask(b.plotter.task_drawEdge,"edge_"+b.id,g):sigma.chronos.addTask(b.plotter.task_drawEdge,"edge_"+b.id,!1),j=!0,g="edge_"+b.id;b.dispatch("draw");b.refresh();j&&sigma.chronos.runTasks();return b};this.resize=function(a,c){var d=b.width,h=b.height;void 0!=a&&void 0!=c?(b.width=a,b.height=c):(b.width=b.domRoot.offsetWidth,b.height=b.domRoot.offsetHeight);if(d!=b.width||h!=b.height){for(var j in b.domElements)b.domElements[j].setAttribute("width",b.width+"px"),b.domElements[j].setAttribute("height",
b.height+"px");b.plotter.resize(b.width,b.height);b.draw(b.p.lastNodes,b.p.lastEdges,b.p.lastLabels,!0)}return b};this.refresh=function(){b.domElements.hover.getContext("2d").clearRect(0,0,b.domElements.hover.width,b.domElements.hover.height);h();D();return b};this.drawHover=h;this.drawActive=D;this.clearSchedule=d}function B(a){var j=this;sigma.classes.EventDispatcher.call(this);this._core=a;this.kill=function(){};this.getID=function(){return a.id};this.configProperties=function(d,c){var h=a.config(d,
c);return h==a?j:h};this.drawingProperties=function(d,c){var h=a.plotter.config(d,c);return h==a.plotter?j:h};this.mouseProperties=function(d,c){var h=a.mousecaptor.config(d,c);return h==a.mousecaptor?j:h};this.graphProperties=function(d,c){var h=a.graph.config(d,c);return h==a.graph?j:h};this.getMouse=function(){return{mouseX:a.mousecaptor.mouseX,mouseY:a.mousecaptor.mouseY,down:a.mousecaptor.isMouseDown}};this.position=function(d,c,h){if(0==arguments.length)return{stageX:a.mousecaptor.stageX,stageY:a.mousecaptor.stageY,
ratio:a.mousecaptor.ratio};a.mousecaptor.stageX=void 0!=d?d:a.mousecaptor.stageX;a.mousecaptor.stageY=void 0!=c?c:a.mousecaptor.stageY;a.mousecaptor.ratio=void 0!=h?h:a.mousecaptor.ratio;return j};this.goTo=function(d,c,h){a.mousecaptor.interpolate(d,c,h);return j};this.zoomTo=function(d,c,h){h=Math.min(Math.max(a.mousecaptor.config("minRatio"),h),a.mousecaptor.config("maxRatio"));h==a.mousecaptor.ratio?a.mousecaptor.interpolate(d-a.width/2+a.mousecaptor.stageX,c-a.height/2+a.mousecaptor.stageY):
a.mousecaptor.interpolate((h*d-a.mousecaptor.ratio*a.width/2)/(h-a.mousecaptor.ratio),(h*c-a.mousecaptor.ratio*a.height/2)/(h-a.mousecaptor.ratio),h);return j};this.resize=function(d,c){a.resize(d,c);return j};this.draw=function(d,c,h,g){a.draw(d,c,h,g);return j};this.refresh=function(){a.refresh();return j};this.addGenerator=function(d,c,h){sigma.chronos.addGenerator(d+"_ext_"+a.id,c,h);return j};this.removeGenerator=function(d){sigma.chronos.removeGenerator(d+"_ext_"+a.id);return j};this.addNode=
function(d,c){a.graph.addNode(d,c);return j};this.addEdge=function(d,c,h,g){a.graph.addEdge(d,c,h,g);return j};this.dropNode=function(d){a.graph.dropNode(d);return j};this.dropEdge=function(d){a.graph.dropEdge(d);return j};this.pushGraph=function(d,c){d.nodes&&d.nodes.forEach(function(d){d.id&&(!c||!a.graph.nodesIndex[d.id])&&j.addNode(d.id,d)});d.edges&&d.edges.forEach(function(d){(validID=d.source&&d.target&&d.id)&&(!c||!a.graph.edgesIndex[d.id])&&j.addNode(d.id,d.source,d.target,d)});return j};
this.emptyGraph=function(){a.graph.empty();return j};this.getNodesCount=function(){return a.graph.nodes.length};this.getEdgesCount=function(){return a.graph.edges.length};this.iterNodes=function(d,c){a.graph.iterNodes(d,c);return j};this.iterEdges=function(d,c){a.graph.iterEdges(d,c);return j};this.getNodes=function(d){return a.graph.getNodes(d)};this.getEdges=function(d){return a.graph.getEdges(d)};this.activateMonitoring=function(){return a.monitor.activate()};this.desactivateMonitoring=function(){return a.monitor.desactivate()};
a.bind("downnodes upnodes downgraph upgraph",function(a){j.dispatch(a.type,a.content)});a.graph.bind("overnodes outnodes click",function(a){j.dispatch(a.type,a.content)});a.mousecaptor.bind("mousewheel",function(a){j.dispatch(a.type,a.content)})}var s=0,t={plugins:[]};sigma.init=function(a){a=new C(a,(++s).toString());sigma.instances[s]=new B(a);return sigma.instances[s]};sigma.addPlugin=function(a,j,d){B.prototype[a]=j;t.plugins.push(d)};sigma.chronos=new function(){function a(a){window.setTimeout(a,
0);return i}function j(){for(i.dispatch("frameinserted");l&&o.length&&d(););!l||!o.length?h():(w=(new Date).getTime(),n++,x=u-r,t=r-x,i.dispatch("insertframe"),a(j))}function d(){s%=o.length;if(!o[s].task()){var a=o[s].taskName;y=y.filter(function(b){b.taskParent==a&&o.push({taskName:b.taskName,task:b.task});return b.taskParent!=a});i.dispatch("killed",o.splice(s--,1)[0])}s++;u=(new Date).getTime()-w;return u<=t}function c(){l=!0;n=s=0;v=w=(new Date).getTime();i.dispatch("start");i.dispatch("insertframe");
a(j);return i}function h(){i.dispatch("stop");l=!1;return i}function g(a,b,d){if("function"!=typeof a)throw Error('Task "'+b+'" is not a function');o.push({taskName:b,task:a});l=!(!l&&!(d&&c()||1));return i}function b(a){return a?Object.keys(m).filter(function(a){return!!m[a].on}).length:Object.keys(m).length}function k(){Object.keys(m).length?(i.dispatch("startgenerators"),i.unbind("killed",f),a(function(){for(var a in m)m[a].on=!0,g(m[a].task,a,!1)}),i.bind("killed",f).runTasks()):i.dispatch("stopgenerators");
return i}function f(a){void 0!=m[a.content.taskName]&&(m[a.content.taskName].del||!m[a.content.taskName].condition()?delete m[a.content.taskName]:m[a.content.taskName].on=!1,0==b(!0)&&k())}sigma.classes.EventDispatcher.call(this);var i=this,l=!1,p=80,q=0,n=0,r=1E3/p,t=r,u=0,v=0,w=0,x=0,m={},o=[],y=[],s=0;this.frequency=function(a){return void 0!=a?(p=Math.abs(1*a),r=1E3/p,n=0,i):p};this.runTasks=c;this.stopTasks=h;this.insertFrame=a;this.addTask=g;this.queueTask=function(a,b,c){if("function"!=typeof a)throw Error('Task "'+
b+'" is not a function');if(!o.concat(y).some(function(a){return a.taskName==c}))throw Error('Parent task "'+c+'" of "'+b+'" is not attached.');y.push({taskParent:c,taskName:b,task:a});return i};this.removeTask=function(a,b){if(void 0==a)o=[],1==b?y=[]:2==b&&(o=y,y=[]),h();else{var c="string"==typeof a?a:"";o=o.filter(function(b){return("string"==typeof a?b.taskName==a:b.task==a)?(c=b.taskName,!1):!0});0<b&&(y=y.filter(function(a){1==b&&a.taskParent==c&&o.push(a);return a.taskParent!=c}))}l=!(o.length&&
(!h()||1));return i};this.addGenerator=function(a,c,d){if(void 0!=m[a])return i;m[a]={task:c,condition:d};0==b(!0)&&k();return i};this.removeGenerator=function(a){m[a]&&(m[a].on=!1,m[a].del=!0);return i};this.startGenerators=k;this.getGeneratorsIDs=function(){return Object.keys(m)};this.getFPS=function(){l&&(q=Math.round(1E4*(n/((new Date).getTime()-v)))/10);return q};this.getTasksCount=function(){return o.length};this.getQueuedTasksCount=function(){return y.length};this.getExecutionTime=function(){return w-
v};return this};sigma.debugMode=0;sigma.log=function(){if(1==sigma.debugMode)for(var a in arguments)console.log(arguments[a]);else if(1<sigma.debugMode)for(a in arguments)throw Error(arguments[a]);return sigma};sigma.easing={linear:{},quadratic:{}};sigma.easing.linear.easenone=function(a){return a};sigma.easing.quadratic.easein=function(a){return a*a};sigma.easing.quadratic.easeout=function(a){return-a*(a-2)};sigma.easing.quadratic.easeinout=function(a){return 1>(a*=2)?0.5*a*a:-0.5*(--a*(a-2)-1)};
sigma.tools.drawRoundRect=function(a,j,d,c,h,g,b){var g=g?g:0,k=b?b:[],k="string"==typeof k?k.split(" "):k,b=g&&(0<=k.indexOf("topleft")||0<=k.indexOf("top")||0<=k.indexOf("left")),f=g&&(0<=k.indexOf("topright")||0<=k.indexOf("top")||0<=k.indexOf("right")),i=g&&(0<=k.indexOf("bottomleft")||0<=k.indexOf("bottom")||0<=k.indexOf("left")),k=g&&(0<=k.indexOf("bottomright")||0<=k.indexOf("bottom")||0<=k.indexOf("right"));a.moveTo(j,d+g);b?a.arcTo(j,d,j+g,d,g):a.lineTo(j,d);f?(a.lineTo(j+c-g,d),a.arcTo(j+
c,d,j+c,d+g,g)):a.lineTo(j+c,d);k?(a.lineTo(j+c,d+h-g),a.arcTo(j+c,d+h,j+c-g,d+h,g)):a.lineTo(j+c,d+h);i?(a.lineTo(j+g,d+h),a.arcTo(j,d+h,j,d+h-g,g)):a.lineTo(j,d+h);a.lineTo(j,d+g)};sigma.tools.getRGB=function(a,g){var a=a.toString(),d={r:0,g:0,b:0};if(3<=a.length&&"#"==a.charAt(0)){var c=a.length-1;6==c?d={r:parseInt(a.charAt(1)+a.charAt(2),16),g:parseInt(a.charAt(3)+a.charAt(4),16),b:parseInt(a.charAt(5)+a.charAt(5),16)}:3==c&&(d={r:parseInt(a.charAt(1)+a.charAt(1),16),g:parseInt(a.charAt(2)+a.charAt(2),
16),b:parseInt(a.charAt(3)+a.charAt(3),16)})}g&&(d=[d.r,d.g,d.b]);return d};sigma.tools.rgbToHex=function(a,g,d){return sigma.tools.toHex(a)+sigma.tools.toHex(g)+sigma.tools.toHex(d)};sigma.tools.toHex=function(a){a=parseInt(a,10);if(isNaN(a))return"00";a=Math.max(0,Math.min(a,255));return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)};sigma.publicPrototype=B.prototype})();
